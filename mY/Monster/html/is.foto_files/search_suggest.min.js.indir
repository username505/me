var curSelection = -1, curSize = 0, curText = "", curTextSel = "", hideDelayTimerId = null, searchSuggestionTimerId = null, maxSuggestions = 10, prevWndResizeEventHandler = null, prevWndOnLoadEventHandler = null, isMsie = !1, suggestRequest = null, suggestionsLoaded = !1, suggestDiv = null, curSearchType = 1, curSuggType = 1, curLang = "tr-TR", htmlFormat = "<div class='searchSuggestDivHolder'><div class='prd'><h3>$$urunlerbaslik$$<small>$$aramaBaslik$$</small></h3><div class='sHolder'>$$urunler$$</div></div><div class='cat'><h3>$$Kategorilerbaslik$$</h3><div class='sHolder'>$$kategoriler$$</div></div><div class='prdCount emos_invisible'><h3>$$urunlerSonucSayisi$$</h3><div class='sHolder'>$$urunSayisi$$ $$sonuctext$$</div></div><div class='brand emos_invisible'><h3>$$markalarLabel$$</h3><div class='sHolder'>$$markalar$$</div></div><div class='dvTumunuGoster emos_invisible'><a href='javascript:void(0);' onclick='return generateSearchLink();' id='ascAramaBtnTumunuGoster' class='btnDefault btnArama'>$$strTumunuGoster$$</a></div><div class='wordSearch'><div class='sHolder'>$$kelimeOnerme$$</div></div><div class='contentSearch'><div class='sHolder emos_invisible'>$$icerikler$$</div></div><div class='manufacturer emos_invisible'><h3>$$yazarlarBaslik$$</h3><div class='sHolder'>$$yazarlar$$</div></div><div class='distributor emos_invisible'><h3>$$yayinevleriBaslik$$</h3><div class='sHolder'>$$yayinevleri$$</div></div><div class='floatFixer'></div></div>"; function attachEventListener(e, t, s) { var r = "on" + t; if (e.addEventListener) e.addEventListener(t, s, !1); else if (e.attachEvent) e.attachEvent(r, s); else { var n = e[r]; e[r] = function () { var e = n.apply(this, arguments), t = s.apply(this, arguments); return void 0 == e ? t : void 0 == t ? e : t && e } } } function initSearchSuggest(e, t, s) { if (curSearchType = e, curSuggType = t, curLang = s, !suggestionsLoaded) { isMsie = -1 != navigator.userAgent.toLowerCase().indexOf("msie"); var r = getSearchBox(); r && (curText = r.value, r.setAttribute("autocomplete", "off"), attachEventListener(r, "keydown", onKeyDownEvent), attachEventListener(r, "keyup", onKeyUpEvent), attachEventListener(r, "keypress", onKeyPressedEvent), attachEventListener(r, "blur", onFocusLost), prevWndResizeEventHandler = window.onresize, attachEventListener(window, "resize", onWindowResized), suggestionsLoaded = !0) } } function onKeyDownEvent(e) { var t = e.keyCode; switch (t) { case 40: moveDown(), stopEvent(e); break; case 38: moveUp(), stopEvent(e) } } function onKeyUpEvent(e) { var t = e.keyCode; switch (t) { case 13: 2 == curSuggType && -1 != curSelection ? window.location.href = searchResult.products[curSelection].productUrl : HideSuggestionsDiv(); break; case 40: case 38: case 37: case 39: break; default: var s = getSearchBox().value; s != curText && (curText = s, setSearchSuggestionTimeout()) } } function onKeyPressedEvent(e) { if (27 == e.keyCode && "none" != getSearchSuggest().style.display) return setSuggestionHideTimeout(), getSearchBox().value = curText, !1 } function onFocusLost(e) { setSuggestionHideTimeout() } function onWindowResized(e) { getSearchSuggest().style.width = getSearchBox().offsetWidth, prevWndResizeEventHandler && prevWndResizeEventHandler(e) } function displaySuggestions(e) { try { curSize = Math.min(maxSuggestions, e.products.length) } catch (t) { curSize = 0 } var s = getSearchSuggest(); s.innerHTML = "", curSize > 0 || null != e.contentData.content && e.contentData.content.length > 0 ? s.style.display = "" : HideSuggestionsDiv(); var r = ""; for (i = 0; i < e.products.length; ++i) { var n = e.products[i]; if (1 == curSuggType) r += '<div id="sugdiv' + i + '" onmouseover="javascript:suggestOver(this);" ', r += 'onmouseout="javascript:suggestOut(this);" ', r += 'onclick="javascript:setSearchByIndex(' + i + ');" ', r += 'class="suggest_link">' + getFormatedSuggestionLine(n.productName) + "</div>"; else { var a = e.searchProductSubscription[i]; r += '<div id="sugdiv' + i + '" onmouseover="javascript:suggestOver(this);" ', r += 'onmouseout="javascript:suggestOut(this);" ', r += "onclick=\"window.location.href='" + n.productUrl + "';\" ", r += 'class="suggest_link"><table border="0" cellpadding="0" cellspacing="0"><tr><th><img border="0" src="' + n.productImageThumb + '"/></th><td class="suggest_urnsname_con"><span>' + getFormatedSuggestionLine(n.productName) + '</span></td><td class="suggest_urnsmallimg_con"><img border="0" class="suggest_urnsmallimg emos_invisible" src="' + n.productImageSmall + '"/></td><td class="suggest_urnprice_con"><span class="suggest_urnprice emos_invisible" ' + ("0" == n.productSalesPrice[0] ? ' style="display:none !important;"' : "") + '">' + n.productSalesPrice + '</span></td><td class="suggest_urnurunkod_con"><span class="suggest_urnurunkod emos_invisible">' + n.productCode + '</span></td><td class="suggest_urnnormalprice_con"><span class="suggest_urnnormalprice emos_invisible">' + n.productNormalPrice + '</span></td><td class="suggest_urnsubscriptiondiscountrate_con"><span class="suggest_urnsubscriptiondiscountrate emos_invisible">' + (null == a || null == a.discountRate || "0" === a.discountRate ? "" : "<span>" + a.discountRate + "</span>") + '</span></td><td class="suggest_urnsubscriptionprice_con"><span class="suggest_urnsubscriptionprice emos_invisible">' + (null == a ? "" : "<span>" + strARAMA_ABONELIKURUNFIYAT + "</span><span>" + a.price + "</span>") + '</span></td><td class="suggest_urndiscountrate_con"><span class="suggest_urndiscountrate emos_invisible">' + (null == n.productDiscountRate || "0" == n.productDiscountRate ? "" : "<span>" + n.productDiscountRate + "</span>") + "</span></td></tr></table></div>" } } var u = ""; for (i = 0; i < e.manufacturers.length; ++i) { var c = e.manufacturers[i]; u += '<div id="manufacturer-suggest' + i + '" onmouseover="javascript:suggestOver(this);" ', u += 'onmouseout="javascript:suggestOut(this);" ', u += "onclick=\"window.location.href='" + c.url + "';\" ", u += 'class="suggest_link"><table border="0" cellpadding="0" cellspacing="0"><tr><td class="manufacturer-name"><span>' + c.name + "</span></td></tr></table></div>" } var o = ""; for (i = 0; i < e.distributors.length; ++i) { var l = e.distributors[i]; o += '<div id="distributor-suggest' + i + '" onmouseover="javascript:suggestOver(this);" ', o += 'onmouseout="javascript:suggestOut(this);" ', o += "onclick=\"window.location.href='" + l.url + "';\" ", o += 'class="suggest_link"><table border="0" cellpadding="0" cellspacing="0"><tr><td class="distributor-name"><span>' + l.name + "</span></td></tr></table></div>" } var g = function (e) { return e = e || [], $.map(e, function (e) { return e.suggestionKeyword || "" }).join(" ") || "" }; s.innerHTML = htmlFormat.replace("$$urunler$$", r).replace("$$kategoriler$$", checkSearchRecord(e.categoryData.category || e.esiCategoryData.category || "")).replace("$$strTumunuGoster$$", strAramaTumunuGoster).replace("$$kelimeOnerme$$", g(e.suggestions) || "").replace("$$aramaBaslik$$", getSuggestionsDivTitle()).replace("$$markalarLabel$$", strMarkalar).replace("$$markalar$$", checkSearchRecord(e.brand.brand)).replace("$$icerikler$$", checkSearchRecord(e.contentData.content)).replace("$$urunSayisi$$", e.productCount).replace("$$urunlerbaslik$$", strAramaSonucUrunBaslik).replace("$$Kategorilerbaslik$$", strAramaSonucKategoriBaslik).replace("$$sonuctext$$", strAramaSonucSayiText).replace("$$urunlerSonucSayisi$$", strAramaSonucUrunlerSonucSayisiBaslik).replace("$$yazarlarBaslik$$", "undefined" != typeof strAramaSonucYazarlarBaslik ? strAramaSonucYazarlarBaslik : "").replace("$$yazarlar$$", checkSearchRecord(u)).replace("$$yayinevleriBaslik$$", "undefined" != typeof strAramaSonucYayinevleriBaslik ? strAramaSonucYayinevleriBaslik : "").replace("$$yayinevleri$$", checkSearchRecord(o)) } function checkSearchRecord(e) { return "" == e ? strAramaSonucBulunamadi : e } function suggestOver(e) { e.style.cursor = "default", unhighlightCurrentSuggestion(), curSelection = (divId = e.id).substr(6), highlightCurrentSuggestion(!1) } function suggestOut(e) { unhighlightSuggestion(e) } function setSearch(e) { curTextSel = e, getSearchBox().value = e } function setSearchByIndex(e) { setSearch(searchResult.products[e].productName), getSearchSuggest().innerHTML = "" } function highlightSuggestion(e) { e.className = "suggest_link_over" } function unhighlightSuggestion(e) { e.className = "suggest_link" } function highlightCurrentSuggestion(e) { e && 1 == curSuggType && (-1 == curSelection ? setSearch(curText) : setSearch(searchResult.suggestions[curSelection])), highlightSuggestion(document.getElementById("sugdiv" + curSelection)) } function unhighlightCurrentSuggestion() { var e = null; try { e = document.getElementById("sugdiv" + curSelection) } catch (t) { } e && unhighlightSuggestion(e) } function moveDown() { if (!(curSize <= 0)) try { unhighlightCurrentSuggestion(), curSelection >= curSize - 1 ? curSelection = -1 : ++curSelection, highlightCurrentSuggestion(!0) } catch (e) { } } function moveUp() { if (!(curSize <= 0)) try { unhighlightCurrentSuggestion(), curSelection < 0 ? curSelection = curSize - 1 : --curSelection, highlightCurrentSuggestion(!0) } catch (e) { } } function stopEvent(e) { isMsie ? e.cancelBubble = !0 : e.preventDefault() } function getFormatedSuggestionLine(e) { var t = curText.toLowerCase(), s = e.toLowerCase(), r = curText.length, n = s.indexOf(t); return -1 == n ? e : e.substr(0, n) + "<b>" + e.substr(n, r) + "</b>" + e.substr(n + r) } function getSearchBox() { return document.getElementById("txtARM_KEYWORD") } function getSearchSuggest() { return suggestDiv || (suggestDiv = createSuggestionDiv(getSearchBox())), suggestDiv } function findPos(e) { var t = curtop = 0; if (e.offsetParent) do t += e.offsetLeft, curtop += e.offsetTop; while (e = e.offsetParent); return [t, curtop] } function createSuggestionDiv(e) { var t = document.createElement("div"); t.className = "searchSuggestDiv", t.style.position = "absolute"; var s = findPos(e); return t.style.left = void 0 === s[0] ? 0 : s[0], isMsie && (t.style.top = (void 0 === s[1] ? 0 : s[1]) + e.offsetHeight), t.style.width = e.offsetWidth, t.style.zIndex = "130", t.style.display = "none", t.id = "search_suggest", e.parentNode.appendChild(t), t } function setSuggestionHideTimeout() { hideDelayTimerId = setTimeout(function () { hideDelayTimerId = null, HideSuggestionsDiv() }, 300) } function setSearchSuggestionTimeout() { searchSuggestionTimerId && (clearTimeout(searchSuggestionTimerId), searchSuggestionTimerId = null), searchSuggestionTimerId = setTimeout(function () { searchJSONSuggest(), searchSuggestionTimerId = null, curSelection = -1 }, 600) } function getSuggestionsDivTitle() { return document.getElementById(aramaClientID + "_lbfARAMA_ONERI").innerHTML } function HideSuggestionsDiv() { curSize = 0, getSearchSuggest().innerHTML = "", getSearchSuggest().style.display = "none", curSelection = -1 } function searchJSONSuggest() { var searchInCtrl = document.getElementById(aramaClientID + "_drpKAT_AD"); curText = getSearchBox().value; var textLength = getSearchBox().getAttribute("data-max") || 3; if (curText.length < textLength) { HideSuggestionsDiv(); return } var srtString = getSearchBox().getAttribute("srt") || "", str = encodeURIComponent(curText); null != searchInCtrl && "" != searchInCtrl.value ? $.get("/userControls/kutu/ascArama_ajx.aspx", "searchType=" + curSearchType + "&suggType=" + curSuggType + "&srt=" + srtString + "&text=" + str + "&kat=" + searchInCtrl.value + "&lang=" + curLang, function (data) { eval(data), "undefined" != typeof stage && stage.dispatchEvent("CustomEvent", "aramaSonucDoldur") }) : $.get("/userControls/kutu/ascArama_ajx.aspx", "searchType=" + curSearchType + "&suggType=" + curSuggType + "&srt=" + srtString + "&text=" + str + "&lang=" + curLang, function (data) { eval(data), "undefined" != typeof stage && stage.dispatchEvent("CustomEvent", "aramaSonucDoldur") }) } function updateCompletion() { suggestRequest && (suggestRequest = null), displaySuggestions(searchResult) }